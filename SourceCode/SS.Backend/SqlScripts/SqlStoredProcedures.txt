CREATE PROCEDURE CheckConflictingReservations
    @companyID INT,
    @floorPlanID INT,
    @spaceID NVARCHAR(255),
    @proposedStartDateTime DATETIME,
    @proposedEndDateTime DATETIME,
    @reservationIdToExclude INT = NULL  -- Default to NULL if not provided
AS
BEGIN
    SELECT reservationID
    FROM dbo.NewAutoIDReservations 
    WHERE companyID = @companyID
    AND floorPlanID = @floorPlanID 
    AND spaceID = @spaceID 
    AND status = 'Active'
    AND NOT (
        reservationEndTime <= @proposedStartDateTime
        OR reservationStartTime >= @proposedEndDateTime
    )
    AND (@reservationIdToExclude IS NULL OR reservationID != @reservationIdToExclude);
END;
GO
